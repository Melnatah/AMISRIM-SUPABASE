// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String    @map("password_hash")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  
  profile       Profile?
  
  @@map("users")
}

model Profile {
  id         String   @id @default(uuid())
  userId     String   @unique @map("user_id")
  firstName  String?  @map("first_name")
  lastName   String?  @map("last_name")
  email      String?
  role       String   @default("resident")
  year       String?
  hospital   String?
  phone      String?
  avatar     String?
  siteId     String?  @map("site_id")
  status     String   @default("approved")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  
  user                  User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  site                  Site?                   @relation(fields: [siteId], references: [id])
  contributions         Contribution[]
  files                 File[]
  leisureEvents         LeisureEvent[]
  leisureContributions  LeisureContribution[]
  leisureParticipants   LeisureParticipant[]
  attendance            Attendance[]
  
  @@index([email])
  @@index([role])
  @@index([siteId])
  @@index([status])
  @@map("profiles")
}

model Site {
  id         String   @id @default(uuid())
  name       String
  type       String?
  supervisor String?
  duration   String?
  address    String?
  city       String?
  phone      String?
  email      String?
  latitude   Decimal?
  longitude  Decimal?
  createdAt  DateTime @default(now()) @map("created_at")
  
  residents  Profile[]
  
  @@map("sites")
}

model Module {
  id          String    @id @default(uuid())
  subjectId   String?   @map("subject_id")
  name        String    @map("name")
  year        String?
  description String?
  category    String?
  createdAt   DateTime  @default(now()) @map("created_at")
  
  subject     Subject?  @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  files       File[]
  
  @@index([subjectId])
  @@map("modules")
}

model Subject {
  id        String   @id @default(uuid())
  name      String   @map("name")
  year      Int?     
  category  String?
  createdAt DateTime @default(now()) @map("created_at")
  
  modules   Module[]
  files     File[] // Direct files on subject if needed
  
  @@map("subjects")
}

model File {
  id         String   @id @default(uuid())
  moduleId   String?  @map("module_id")
  subjectId  String?  @map("subject_id")
  name       String
  type       String?
  url        String
  size       BigInt?
  uploadedBy String?  @map("uploaded_by")
  createdAt  DateTime @default(now()) @map("created_at")
  
  module     Module?  @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  subject    Subject? @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  uploader   Profile? @relation(fields: [uploadedBy], references: [id])
  
  @@index([moduleId])
  @@index([subjectId])
  @@map("files")
}

model Contribution {
  id              String    @id @default(uuid())
  profileId       String?   @map("profile_id")
  contributorName String?   @map("contributor_name")
  contributorType String?   @map("contributor_type")
  reason          String?
  amount          Decimal
  month           String?
  year            String?
  status          String    @default("pending")
  paymentMethod   String?   @map("payment_method")
  paymentDate     DateTime? @map("payment_date")
  createdAt       DateTime  @default(now()) @map("created_at")
  
  profile         Profile?  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@index([profileId])
  @@index([status])
  @@index([year])
  @@map("contributions")
}

model Message {
  id        String   @id @default(uuid())
  sender    String?
  role      String?
  subject   String?
  content   String
  priority  String   @default("info")
  type      String?
  createdAt DateTime @default(now()) @map("created_at")
  
  @@index([createdAt(sort: Desc)])
  @@map("messages")
}

model Setting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String?
  updatedAt DateTime @updatedAt @map("updated_at")
  
  @@map("settings")
}

model LeisureEvent {
  id              String    @id @default(uuid())
  title           String
  description     String?
  type            String?
  eventDate       DateTime? @map("event_date")
  location        String?
  maxParticipants Int?      @map("max_participants")
  costPerPerson   Decimal?  @map("cost_per_person")
  imageUrl        String?   @map("image_url")
  createdBy       String?   @map("created_by")
  createdAt       DateTime  @default(now()) @map("created_at")
  
  creator         Profile?               @relation(fields: [createdBy], references: [id])
  contributions   LeisureContribution[]
  participants    LeisureParticipant[]
  
  @@map("leisure_events")
}

model LeisureContribution {
  id            String   @id @default(uuid())
  eventId       String   @map("event_id")
  profileId     String   @map("profile_id")
  amount        Decimal
  paymentStatus String   @default("pending") @map("payment_status")
  createdAt     DateTime @default(now()) @map("created_at")
  
  event         LeisureEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  profile       Profile      @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@index([eventId])
  @@index([profileId])
  @@map("leisure_contributions")
}

model LeisureParticipant {
  id        String   @id @default(uuid())
  eventId   String   @map("event_id")
  profileId String   @map("profile_id")
  status    String   @default("pending")
  createdAt DateTime @default(now()) @map("created_at")
  
  event     LeisureEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  profile   Profile      @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@index([eventId])
  @@index([profileId])
  @@map("leisure_participants")
}

model Attendance {
  id        String   @id @default(uuid())
  profileId String   @map("profile_id")
  itemType  String   @map("item_type")
  itemId    String?  @map("item_id")
  status    String   @default("pending")
  createdAt DateTime @default(now()) @map("created_at")
  
  profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@index([profileId])
  @@index([status])
  @@index([itemType])
  @@map("attendance")
}
